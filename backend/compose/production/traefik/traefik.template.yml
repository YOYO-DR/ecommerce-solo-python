log:
  level: DEBUG
  format: common

accessLog: {}

entryPoints:
  web:
    address: ":80"

http:
  routers:
    # Router para API (Django)
    api-router:
      rule: 'Host(`${DOMAIN}`) && PathPrefix(`/api/`) && !PathPrefix(`/api/media/`)'
      entryPoints:
        - web
      service: django
      middlewares:
        - secure-headers

    # Router para archivos media (Nginx)
    media-router:
      rule: 'Host(`${DOMAIN}`) && PathPrefix(`/api/media/`)'
      entryPoints:
        - web
      service: django-media
      middlewares:
        - secure-headers

    # Router para frontend (React/Vue/etc)
    frontend-router:
      rule: 'Host(`${DOMAIN}`)'
      entryPoints:
        - web
      service: frontend
      middlewares:
        - secure-headers
      priority: 1


  middlewares:
    # Headers de seguridad
    secure-headers:
      headers:
        customResponseHeaders:
          X-Frame-Options: "DENY"
          X-Content-Type-Options: "nosniff"
          X-XSS-Protection: "1; mode=block"
          Referrer-Policy: "strict-origin-when-cross-origin"

  services:
    # Servicio Django (API)
    django:
      loadBalancer:
        servers:
          - url: http://django:5000

    # Servicio Nginx (archivos media)
    django-media:
      loadBalancer:
        servers:
          - url: http://nginx:80

    # Servicio Frontend
    frontend:
      loadBalancer:
        servers:
          - url: http://frontend:80

# Configuraci√≥n del provider file
providers:
  file:
    filename: /etc/traefik/traefik.yml
    watch: true
